<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>回転する立方体</title>
  <style>
    body { margin: 0; background: #f0f8ff; }
    canvas { display: block; margin: auto; background: #ffffff; }
  </style>
</head>
<body>
  <canvas id="cubeCanvas" width="500" height="500"></canvas>
  <script>
    const canvas = document.getElementById('cubeCanvas');
    const ctx = canvas.getContext('2d');

    let angle = 0;

    const cubeSize = 100;
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;

    function rotateX(point, theta) {
      const cos = Math.cos(theta);
      const sin = Math.sin(theta);
      return {
        x: point.x,
        y: point.y * cos - point.z * sin,
        z: point.y * sin + point.z * cos
      };
    }

    function rotateY(point, theta) {
      const cos = Math.cos(theta);
      const sin = Math.sin(theta);
      return {
        x: point.x * cos - point.z * sin,
        y: point.y,
        z: point.x * sin + point.z * cos
      };
    }

    function project(point) {
      const scale = 300 / (point.z + 400);
      return {
        x: centerX + point.x * scale,
        y: centerY + point.y * scale
      };
    }

    const vertices = [
      {x: -1, y: -1, z: -1},
      {x:  1, y: -1, z: -1},
      {x:  1, y:  1, z: -1},
      {x: -1, y:  1, z: -1},
      {x: -1, y: -1, z:  1},
      {x:  1, y: -1, z:  1},
      {x:  1, y:  1, z:  1},
      {x: -1, y:  1, z:  1}
    ];

    const edges = [
      [0,1],[1,2],[2,3],[3,0],
      [4,5],[5,6],[6,7],[7,4],
      [0,4],[1,5],[2,6],[3,7]
    ];

    const faces = [
      [0,1,2,3],
      [4,5,6,7],
      [0,1,5,4],
      [2,3,7,6],
      [0,3,7,4],
      [1,2,6,5]
    ];

    const faceColors = ["#1E90FF", "#4682B4", "#5F9EA0", "#87CEFA", "#6495ED", "#4169E1"];

    function drawCube() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const rotated = vertices.map(v => rotateY(rotateX({...v}, angle), angle));
      const projected = rotated.map(v => project({ x: v.x * cubeSize, y: v.y * cubeSize, z: v.z * cubeSize }));

      // 描画順を調整して立体感を出す（zの平均値でソート）
      const faceDepth = faces.map((face, i) => {
        const zAvg = face.reduce((sum, idx) => sum + rotated[idx].z, 0) / 4;
        return { index: i, zAvg };
      }).sort((a, b) => b.zAvg - a.zAvg);

      faceDepth.forEach(({ index }) => {
        const face = faces[index];
        ctx.beginPath();
        ctx.moveTo(projected[face[0]].x, projected[face[0]].y);
        for (let i = 1; i < face.length; i++) {
          ctx.lineTo(projected[face[i]].x, projected[face[i]].y);
        }
        ctx.closePath();
        ctx.fillStyle = faceColors[index];
        ctx.fill();
        ctx.strokeStyle = "#000";
        ctx.stroke();
      });
    }

    function animate() {
      angle += 0.01;
      drawCube();
      requestAnimationFrame(animate);
    }

    animate();
  </script>
</body>
</html>
